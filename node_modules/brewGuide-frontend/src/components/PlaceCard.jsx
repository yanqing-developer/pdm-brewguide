import React from "react";

function formatDistance(place) {
  // prefer meters if present
  if (place?.distance_m != null && Number.isFinite(place.distance_m)) {
    const m = place.distance_m;
    const km = m / 1000;
    return km < 1 ? `${Math.round(m)} m` : `${km.toFixed(1)} km`;
  }
  // fallback: backend may return _distanceKm
  if (place?._distanceKm != null && Number.isFinite(place._distanceKm)) {
    return `${place._distanceKm.toFixed(1)} km`;
  }
  return null;
}

export default function PlaceCard({ place, onSave, onDismiss, onSimilar }) {
  return (
    <div>
      <div className="place-title">
        <h3>{place.name || "(Unnamed brewery)"}</h3>
        <div className="small">
          {place.brewery_type ? <span className="badge">{place.brewery_type}</span> : null}
           {(place.has_website || !!place.website_url) ? <span className="badge">website</span> : null}
          {formatDistance(place) ? (
            <span className="badge">{formatDistance(place)}</span>
          ) : null}
        </div>
      </div>

      <div className="small" style={{ marginTop: 6 }}>
        {place.explanation || "Recommended based on your preferences."}
      </div>

      {place.website_url ? (
        <div className="small" style={{ marginTop: 6 }}>
          <a href={place.website_url} target="_blank" rel="noreferrer">Visit site</a>
        </div>
      ) : null}

      <div className="actions">
        <button onClick={() => onSave(place.id)}>Save</button>
        <button className="secondary" onClick={() => onDismiss(place.id)}>Dismiss</button>
        <button className="secondary" onClick={() => onSimilar(place.id)}>Show similar</button>
      </div>

      <hr />
    </div>
  );
  
};
